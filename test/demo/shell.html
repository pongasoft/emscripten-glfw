<!doctype html>
<html lang="EN-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

  <title>emscripten glfw test client</title>

  <style>
    body {
      margin: 0px;
    }

    .hidden {
      display: none;
    }

    .bordered {
      border: solid 2px black;
    }

    .handle {
      position: absolute;
      bottom: 0;
      right: 0;
      margin-bottom: 1px;
      margin-right: 1px;
      border-left: 20px solid transparent;
      border-bottom: 20px solid rgba(102, 102, 102, 0.5);
      width: 0;
      height: 0;
      cursor: nwse-resize;
      z-index: 1;
    }

    canvas.emscripten {
      margin: 20px;
      border: 0px none;
      width: 315px;
      height: 210px;
      background-color: black;
      image-rendering: pixelated;
      touch-action: none;
    }

    #canvas-details .table-bordered {
      float: left;
    }

    .clear-float {
      clear: both;
    }

    #actions .table-bordered {
      float: left;
    }

    #actions input {
      font-family: monospace;
      font-size: smaller;
    }

    #canvases {
      display: inline-block;
    }

    #canvas1 {
      float: left;
    }

    #canvas2-container {
      margin: 20px;
      width: 300px;
      height: 200px;
      position: relative;
    }

    #canvas2-area {
      float: right;
    }

    #canvas2 {
      margin: 0;
    }

    #canvas2-caption {
      text-align: center;
      font-family: monospace;
      font-size: smaller;
      font-style: italic;
      margin-top: -15px;
    }

    .table-bordered {
      font-family: monospace;
      font-size: xx-small;
      flex: auto;
    }

    .table-bordered>tbody>tr>td,
    .table-bordered>tbody>tr>th,
    .table-bordered>tfoot>tr>td,
    .table-bordered>tfoot>tr>th,
    .table-bordered>thead>tr>td,
    .table-bordered>thead>tr>th {
      border:1px solid #ddd
    }

    .table-bordered th, .table-bordered tr, .table-bordered td {
      padding: 0 12px;
    }

    .table-bordered tbody tr:nth-of-type(even) {
      background-color: #f3f3f3;
    }

    #actions td[colspan="2"] {
      text-align: center;
    }

    #debug {
      position: fixed;
      top: 0;
      right: 0;
    }

    #version {
      position: fixed;
      bottom: 0;
      right: 0;
      font-family: monospace;
      font-size: x-small;
      color: lightgray;
    }
  </style>
</head>
<body>
<div id="canvases">
  <canvas class=emscripten id=canvas1 style="width: 285px; height: 190px;" oncontextmenu=event.preventDefault() tabindex=0></canvas>
  <div id="canvas2-area">
    <div class="bordered" id="canvas2-container"> <!-- the container used to determine the size of the container -->
      <div id="canvas2-handle" class="handle"></div> <!-- the handle used to resize the container -->
      <canvas class=emscripten id=canvas2 oncontextmenu=event.preventDefault() tabindex=0></canvas>
    </div>
    <div id="canvas2-caption"><span class="size-limit hidden">Size Limits: On </span><span class="aspect-ratio hidden">Aspect Ratio: On</span></div>
  </div>
</div>
<div id="canvas-details">
  <table class="table-bordered">
    <thead>
    <tr><th>glfw (callbacks)</th><th>#1</th><th>#2</th></tr>
    </thead>
    <tbody>
    <tr class="glfwSetCursorPosCallback"><td>glfwSetCursorPosCallback</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwSetWindowPosCallback"><td>glfwSetWindowPosCallback</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwSetMouseButtonCallback"><td>glfwSetMouseButtonCallback</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwSetCursorEnterCallback"><td>glfwSetCursorEnterCallback</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwSetScrollCallback"><td>glfwSetScrollCallback</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwSetKeyCallback"><td>glfwSetKeyCallback</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwSetCharCallback"><td>glfwSetCharCallback</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwSetWindowSizeCallback"><td>glfwSetWindowSizeCallback</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwSetFramebufferSizeCallback"><td>glfwSetFramebufferSizeCallback</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwSetWindowFocusCallback"><td>glfwSetWindowFocusCallback</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwSetWindowContentScaleCallback"><td>glfwSetWindowContentScaleCallback</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwSetJoystickCallback"><td>glfwSetJoystickCallback</td><td class="no-canvas" colspan="2">-</td></tr>
    </tbody>
  </table>
  <table class="table-bordered">
    <thead>
    <tr><th>glfw (direct)</th><th>#1</th><th>#2</th></tr>
    </thead>
    <tbody>
    <tr class="glfwGetCursorPos"><td>glfwGetCursorPos</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwGetWindowPos"><td>glfwGetWindowPos</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwGetInputMode_GLFW_CURSOR"><td>glfwGetInputMode(GLFW_CURSOR)</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwGetMouseButton"><td>glfwGetMouseButton</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwGetKey"><td>glfwGetKey</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwGetKey2"><td>glfwGetKey [Left]</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwGetWindowSize"><td>glfwGetWindowSize</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwGetFramebufferSize"><td>glfwGetFramebufferSize</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwGetWindowContentScale"><td>glfwGetWindowContentScale</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwGetWindowOpacity"><td>glfwGetWindowOpacity</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwGetWindowTitle"><td>glfwGetWindowTitle</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwGetWindowAttrib-visible"><td>glfwGetWindowAttrib(GLFW_VISIBLE)</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwGetWindowAttrib-hovered"><td>glfwGetWindowAttrib(GLFW_HOVERED)</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwGetWindowAttrib-focused"><td>glfwGetWindowAttrib(GLFW_FOCUSED)</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwGetWindowAttrib-resizable"><td>glfwGetWindowAttrib(GLFW_RESIZABLE)</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwGetWindowAttrib-scale_to_monitor"><td>glfwGetWindowAttrib(GLFW_SCALE_TO_MONITOR)</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwGetWindowAttrib-scale_framebuffer"><td>glfwGetWindowAttrib(GLFW_SCALE_FRAMEBUFFER)</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwGetTime"><td>glfwGetTime</td><td class="no-canvas" colspan="2">-</td></tr>
    <tr class="glfwGetTimerValue"><td>glfwGetTimerValue</td><td class="no-canvas" colspan="2">-</td></tr>
    <tr class="glfwGetClipboardString"><td>glfwGetClipboardString</td><td class="no-canvas" colspan="2">-</td></tr>
    </tbody>
    <tbody id="joystick">
    <tr class="glfwGetJoystickName"><td>glfwGetJoystickName</td><td class="no-canvas" colspan="2">-</td></tr>
    <tr class="glfwGetJoystickGUID"><td>glfwGetJoystickGUID</td><td class="no-canvas" colspan="2">-</td></tr>
    <tr class="glfwJoystickIsGamepad"><td>glfwJoystickIsGamepad</td><td class="no-canvas" colspan="2">-</td></tr>
    <tr class="glfwGetJoystickAxes"><td>glfwGetJoystickAxes</td><td class="no-canvas" colspan="2">-</td></tr>
    <tr class="glfwGetJoystickButtons"><td>glfwGetJoystickButtons</td><td class="no-canvas" colspan="2">-</td></tr>
    <tr class="glfwGetJoystickHats"><td>glfwGetJoystickHats</td><td class="no-canvas" colspan="2">-</td></tr>
    <tr class="glfwGetGamepadState-axes"><td>glfwGetGamepadState(axes)</td><td class="no-canvas" colspan="2">-</td></tr>
    <tr class="glfwGetGamepadState-buttons"><td>glfwGetGamepadState(buttons)</td><td class="no-canvas" colspan="2">-</td></tr>
    </tbody>
  </table>
</div>
<h4 class="clear-float">Actions</h4>
<div id="actions">
  <table class="table-bordered">
    <thead>
    <tr><th>Action</th><th>#1</th><th>#2</th></tr>
    </thead>
    <tbody>
    <tr>
      <td class="action">glfwSetWindowSize</td>
      <td>
        <input type="button" value="+" onclick="Module.pushEvent('zoom_in', '#canvas1')">
        <input type="button" value="-" onclick="Module.pushEvent('zoom_out', '#canvas1')">
        <input type="button" value="Reset" onclick="Module.pushEvent('zoom_reset', '#canvas1')">
      </td>
      <td>
        <input type="button" value="+" onclick="Module.pushEvent('zoom_in', '#canvas2')">
        <input type="button" value="-" onclick="Module.pushEvent('zoom_out', '#canvas2')">
        <input type="button" value="Reset" onclick="Module.pushEvent('zoom_reset', '#canvas2')">
      </td>
    </tr>
    <tr>
      <td class="action">glfwSetWindowOpacity</td>
      <td>
        <input type="button" value="30%" onclick="Module.pushEvent('opacity_30', '#canvas1')">
        <input type="button" value="60%" onclick="Module.pushEvent('opacity_60', '#canvas1')">
        <input type="button" value="100%" onclick="Module.pushEvent('opacity_100', '#canvas1')">
      </td>
      <td>
        <input type="button" value="30%" onclick="Module.pushEvent('opacity_30', '#canvas2')">
        <input type="button" value="60%" onclick="Module.pushEvent('opacity_60', '#canvas2')">
        <input type="button" value="100%" onclick="Module.pushEvent('opacity_100', '#canvas2')">
      </td>
    </tr>
    <tr class="glfwShowWindow">
      <td class="action">glfwShowWindow / glfwHideWindow</td>
      <td><input class="canvas1" type="button" value="Toggle Show/Hide" onclick="Module.pushEvent('toggle_show', '#canvas1')"></td>
      <td><input class="canvas2" type="button" value="Toggle Show/Hide" onclick="Module.pushEvent('toggle_show', '#canvas2')"></td>
    </tr>
    <tr class="glfwShowWindow">
      <td class="action">glfwSetWindowAttrib(GLFW_RESIZABLE)</td>
      <td>-</td>
      <td><input class="canvas2" type="button" value="Toggle Resizable"
                 onclick="Module.toggleResizable('#canvas2')"></td>
    </tr>
    <tr class="glfwSetWindowSizeLimits">
      <td class="action">glfwSetWindowSizeLimits(150x100, 300x200)</td>
      <td>-</td>
      <td><input class="canvas2" type="button" value="Toggle Size Limits" onclick="Module.toggleSizeLimits('#canvas2')"></td>
    </tr>
    <tr class="glfwSetWindowAspectRatio">
      <td class="action">glfwSetWindowAspectRatio(3:2)</td>
      <td>-</td>
      <td><input class="canvas2" type="button" value="Toggle Aspect Ratio" onclick="Module.toggleAspectRatio('#canvas2')"></td>
    </tr>
    <tr class="glfwSetWindowTitle">
      <td class="action">glfwSetWindowTitle</td>
      <td><input class="canvas1" type="button" value="Update title" onclick="Module.pushEvent('update_title', '#canvas1')"></td>
      <td><input class="canvas2" type="button" value="Update title" onclick="Module.pushEvent('update_title', '#canvas2')"></td>
    </tr>
    <tr>
      <td class="action">glfwSetWindowShouldClose</td>
      <td><input type="button" value="Close" onclick="Module.pushEvent('close', '#canvas1')"></td>
      <td><input type="button" value="Close" onclick="Module.pushEvent('close', '#canvas2')"></td>
    </tr>
    <tr class="glfwSetWindowAttrib-scale_framebuffer">
      <td class="action">Hi DPI Aware</td>
      <td><input class="canvas1" type="button" value="Enable" onclick="Module.pushEvent('toggle_hi_dpi_aware', '#canvas1')"></td>
      <td><input class="canvas2" type="button" value="Disable" onclick="Module.pushEvent('toggle_hi_dpi_aware', '#canvas2')"></td>
    </tr>
    <tr>
      <td class="action">Enable/Disable</td>
      <td><input id="canvas1-enable-action" type="button" value="-" onclick="toggleCanvasVisibility(1);"></td>
      <td><input id="canvas2-enable-action" type="button" value="-" onclick="toggleCanvasVisibility(2);"></td>
    </tr>
    <tr>
      <td class="action">Left Mouse Click</td>
      <td colspan="2">
        <label for="lmbc-noAction">N/A</label><input type="radio" id="lmbc-noAction" name="lmbc-action" value="0" checked>
        <label for="lmbc-OpenURL">Open URL</label><input type="radio" id="lmbc-OpenURL" name="lmbc-action" value="1">
        <label for="lmbc-glfwSetClipboardString">Clipboard</label><input type="radio" id="lmbc-glfwSetClipboardString" name="lmbc-action" value="2">
      </td>
    </tr>
    <tr>
      <td class="action">Left Mouse Release</td>
      <td colspan="2">
        <label for="lmbr-noAction">N/A</label><input type="radio" id="lmbr-noAction" name="lmbr-action" value="0" checked>
        <label for="lmbr-OpenURL">Open URL</label><input type="radio" id="lmbr-OpenURL" name="lmbr-action" value="1">
        <label for="lmbr-glfwSetClipboardString">Clipboard</label><input type="radio" id="lmbr-glfwSetClipboardString" name="lmbr-action" value="2">
      </td>
    </tr>
    <tr>
      <td class="action">Fullscreen</td>
      <td>
        <input type="button" value="Fullscreen"
               onclick="Module.glfwRequestFullscreen('#canvas1', document.getElementById('pointerLock-canvas1').checked, document.getElementById('resizeCanvas-canvas1').checked);">
        <label for="resizeCanvas-canvas1">R</label><input type="checkbox" id="resizeCanvas-canvas1" checked>&nbsp;
        <label for="pointerLock-canvas1">L</label><input type="checkbox" id="pointerLock-canvas1">
      </td>
      <td>
        <input type="button" value="Fullscreen"
               onclick="Module.glfwRequestFullscreen('#canvas2', document.getElementById('pointerLock-canvas2').checked, document.getElementById('resizeCanvas-canvas2').checked);">
        <label for="resizeCanvas-canvas2">R</label><input type="checkbox" id="resizeCanvas-canvas2" checked>&nbsp;
        <label for="pointerLock-canvas2">L</label><input type="checkbox" id="pointerLock-canvas2">
      </td>
    </tr>
    <tr>
      <td class="action">Fullscreen (no target)</td>
      <td colspan="2">
        <input type="button" value="Fullscreen" onclick="Module.requestFullscreen(document.getElementById('pointerLock-any').checked, document.getElementById('resizeCanvas-any').checked);">
        <label for="resizeCanvas-any">R</label><input type="checkbox" id="resizeCanvas-any" checked>&nbsp;
        <label for="pointerLock-any">L</label><input type="checkbox" id="pointerLock-any">
      </td>
    </tr>
    <tr>
      <td class="action">Change focus</td>
      <td colspan="2"><label>Text: <input type="text" id="change-focus"></label></td>
    </tr>
    <tr>
      <td class="action">Exit main loop</td>
      <td colspan="2"><input type="button" value="Exit" onclick="Module.pushEvent('exit');"></td>
    </tr>
    </tbody>
  </table>
  <table class="table-bordered">
    <thead>
    <tr><th>Action</th><th>Use <span id="action-key">-</span> + &lt;key&gt;</th></tr>
    </thead>
    <tbody>
    <tr><td class="action">Copy/Cut (title)</td><td>"C"/"X"</td></tr>
    <tr><td class="action">Paste</td><td>"V"</td></tr>
    <tr><td class="action">Hide/Show Cursor</td><td>"H"</td></tr>
    <tr><td class="action">Lock/Unlock Cursor</td><td>"L" (ESC will unlock as well)</td></tr>
    <tr><td class="action">Cycle Cursor</td><td>"[" &amp; "]"</td></tr>
    <tr><td class="action">Toggle Hi DPI Aware</td><td>"4"</td></tr>
    </tbody>
  </table>
</div>
<span class="clear-float"></span>
<table id="debug" class="table-bordered">
  <tbody>
  </tbody>
</table>
<div id="version"></div>
<p>

<script>

  var isCanvasEnabled = (name) => {
    const urlParams = new URLSearchParams(window.location.search);
    if(urlParams.has(name))
      return urlParams.get(name) !== "disabled";
    else
      return true;
  }

  var Module = {
    canvas: (function() {
      return document.getElementById('canvas1');
    })(),
    canvas1Enabled: isCanvasEnabled("canvas1"),
    canvas2Enabled: isCanvasEnabled("canvas2"),
    eventTypes: {
      exit: 1, toggle_show: 2, zoom_in: 3, zoom_out: 4, zoom_reset: 5,
      opacity_30: 6, opacity_60: 7, opacity_100: 8, close: 9, toggle_hi_dpi_aware: 10,
      toggle_resizable: 11, toggle_size_limits: 12, toggle_aspect_ratio: 13,
      update_title: 14
    },
    events: [],
    hasEvents: () => { return Module.events.length > 0; },
    pushEvent: (name, canvasSelector) => {
      Module.events.push({type: Module.eventTypes[name], canvas: Module.glfwGetWindow(canvasSelector)});
    },
    popEvent: () => { return Module.events.shift(); },
    toggleCSSClass: (selector, cssClass) => {
      const element = document.querySelector(selector);
      if(element)
      {
        if(element.classList.contains(cssClass))
          element.classList.remove(cssClass);
        else
          element.classList.add(cssClass);
      }
    },
    toggleHTMLElement: (selector) => Module.toggleCSSClass(selector, 'hidden'),
    showHTMLElement: (selector) => {
      const element = document.querySelector(selector);
      if(element)
      {
        if(element.classList.contains('hidden'))
          element.classList.remove('hidden');
      }
    },
    hideHTMLElement: (selector) => {
      const element = document.querySelector(selector);
      if(element)
      {
        if(!element.classList.contains('hidden'))
          element.classList.add('hidden');
      }
    },
    toggleResizable: (canvas) => {
      Module.toggleCSSClass(canvas + '-container', 'bordered');
      Module.toggleHTMLElement(canvas + '-handle');
      Module.pushEvent('toggle_resizable', canvas)
    },
    toggleSizeLimits: (canvas) => {
      Module.pushEvent('toggle_size_limits', canvas);
      Module.toggleHTMLElement(canvas + '-caption .size-limit');
    },
    toggleAspectRatio: (canvas) => {
      Module.pushEvent('toggle_aspect_ratio', canvas);
      Module.toggleHTMLElement(canvas + '-caption .aspect-ratio');
    },
    getLMBAction: (action) => {
      const actions = document.getElementsByName(action);

      for (var i = 0, length = actions.length; i < length; i++) {
        if (actions[i].checked) {
          return parseInt(actions[i].value);
        }
      }

      return 0;
    }
  };

  var toggleCanvasVisibility = (id) => {
    if(id === 1)
      Module.canvas1Enabled = !Module.canvas1Enabled;
    if(id === 2)
      Module.canvas2Enabled = !Module.canvas2Enabled;
    let location = [];
    if(!Module.canvas1Enabled)
      location.push("canvas1=disabled");
    if(!Module.canvas2Enabled)
      location.push("canvas2=disabled");
    console.log(location);
    window.location.search = '?' + location.join('&');
  }

  const c1EnableAction = document.getElementById('canvas1-enable-action');
  c1EnableAction.value = Module.canvas1Enabled ? "Disable" : "Enable";

  const c2EnableAction = document.getElementById('canvas2-enable-action');
  c2EnableAction.value = Module.canvas2Enabled ? "Disable" : "Enable";

  // var debug = (key, message) => {
  //   var elt = document.querySelector("#debug ." + key.toString());
  //   if(!elt)
  //   {
  //     const row = document.createElement("tr");
  //     const keyCell = document.createElement("td");
  //     keyCell.innerHTML = key.toString();
  //     row.appendChild(keyCell);
  //     elt = document.createElement("td");
  //     elt.className = key;
  //     row.appendChild(elt);
  //     document.querySelector("#debug tbody").appendChild(row);
  //   }
  //   elt.innerHTML = message.toString();
  // };
  //
  // window.onresize = (event) => {
  //   debug("window-onresize-innerWidth", window.innerWidth);
  //   debug("window-onresize-innerHeight", window.innerHeight);
  // };
  //
  // window.onscroll = (event) => {
  //   debug("window-onscroll-scrollX", window.scrollX);
  //   debug("window-onscroll-scrollY", window.scrollY);
  // }
  //
  // document.onkeydown = (e) => {
  //   // computing scancode in javascript to see if that works
  //   let scancode = 0;
  //   for(let i = 0; i < e.code.length; i++) {
  //     scancode = ((scancode ^ 0x7E057D79) << 3) ^ e.code.charCodeAt(i);
  //   }
  //   debug("document-onkeydown", e.code + "|" + e.keyCode + "|" + e.key + "|" + e.key.charCodeAt(0) + "|" + (scancode >>> 0).toString(16).toUpperCase());
  // }
  //
  // document.onfullscreenchange = (e) => {
  //   debug("document-onfullscreenchange", document.fullscreenElement ? document.fullscreenElement.id : "none");
  // }

</script>
  <script async src='main.js'></script>
</body>
</html>
